  \subsection[OpenStack son utilisation]{Utiliser OpenStack}

  \begin{frame}
    \frametitle{Le principe}
    \begin{itemize}
      \item Toutes les fonctionnalités sont accessibles par l'API
      \item Les clients (y compris Horizon) utilisent l'API
      \item Des crédentials sont nécessaires
      \begin{itemize}
        \item API OpenStack : utilisateur + mot de passe + tenant
        \item API AWS : access key ID + secret access key
      \end{itemize}
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Les APIs OpenStack}
    \begin{itemize}
      \item Une API par service OpenStack
      \item \url{http://developer.openstack.org/\#api}
      \item Chaque API est versionnée, la rétro-compatibilité est assurée
      \item REST
      \item Certains services sont aussi accessibles via une API différente compatible AWS
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Accès aux APIs}
    \begin{itemize}
      \item Direct, en HTTP, via des outils comme curl
      \item Avec une bibliothèque
      \begin{itemize}
        \item Les implémentations officielles en Python
        \item OpenStackSDK
        \item D'autres implémentations, y compris pour d'autres langages (exemple : jclouds)
        \item Shade
      \end{itemize}
      \item Avec les outils officiels en ligne de commande
      \item Avec Horizon
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Clients officiels}
    \begin{itemize}
      \item Le projet fournit des clients officiels : python-PROJETclient
      \item Bibliothèques Python
      \item Outils CLI
      \begin{itemize}
        \item L'authentification se fait en passant les credentials par paramètres ou variables d'environnement
        \item L'option --debug affiche la communication HTTP
      \end{itemize}
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{OpenStack Client}
    \begin{itemize}
      \item Client CLI unifié
      \item Commandes du type \textit{openstack <service> <action>}
      \item Vise à remplacer à terme les clients spécifiques
      \item Permet une expérience utilisateur plus homogène
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Shade}
    \begin{itemize}
      \item Bibliothèque Python incluant la business logic
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Authentification et catalogue de service}
    \begin{itemize}
      \item Une fois authentifié, récupération d'un jeton (\textit{token})
      \item Récupération du catalogue de services
      \item Pour chaque service, un endpoint HTTP (API)
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Utiliser des images cloud}
    Une image cloud c'est :
    \begin{itemize}
      \item Une image disque contenant un OS déjà installé
      \item Une image qui peut être instanciée en n machines sans erreur
      \item Un OS sachant parler à l'API de metadata du cloud (cloud-init)
    \end{itemize}
    Détails : \url{http://docs.openstack.org/image-guide/content/ch\_openstack\_images.html}\\
    La plupart des distributions fournissent aujourd'hui des images cloud.
  \end{frame}

  \begin{frame}
    \frametitle{Cirros}
    \begin{itemize}
      \item Cirros est l'image cloud par excellence
      \item OS minimaliste
      \item Contient cloud-init
    \end{itemize}
    \url{https://launchpad.net/cirros}
  \end{frame}

  \begin{frame}
    \frametitle{Cloud-init}
    \begin{itemize}
      \item Cloud-init est un moyen de tirer partie de l'API de metadata, et notamment des user data
      \item L'outil est intégré par défaut dans la plupart des images cloud
      \item À partir des user data, cloud-init effectue les opérations de personnalisation de l'instance
      \item cloud-config est un format possible de user data
    \end{itemize}
  \end{frame}

  \begin{frame}[containsverbatim]
    \frametitle{Exemple cloud-config}
\begin{verbatim}
#cloud-config
mounts:
 - [ xvdc, /var/www ]
packages:
 - apache2
 - htop
\end{verbatim}
  \end{frame}

  \begin{frame}
    \frametitle{Comment gérer ses images ?}
    \begin{itemize}
      \item Utilisation d'images génériques et personnalisation à l'instanciation
      \item Création d'images intermédiaires et/ou totalement personnalisées : \textit{Golden images}
      \begin{itemize}
        \item libguestfs, virt-builder, virt-sysprep
        \item diskimage-builder (TripleO)
        \item Packer
        \item solution "maison"
      \end{itemize}
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Propriétés d'une instance}
    \begin{itemize}
      \item Éphémère, a priori non hautement disponible
      \item Définie par une flavor
      \item Construite à partir d'une image
      \item Optionnel : attachement de volumes
      \item Optionnel : boot depuis un volume
      \item Optionnel : une clé SSH publique
      \item Optionnel : des ports réseaux
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Les groupes de sécurité}
    \begin{itemize}
      \item Équivalent à un firewall devant chaque instance
      \item Une instance peut être associée à un ou plusieurs groupes de sécurité
      \item Gestion des accès en entrée et sortie
      \item Règles par protocole (TCP/UDP/ICMP) et par port
      \item Cible une adresse IP, un réseau ou un autre groupe de sécurité
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Flavors}
    \begin{itemize}
      \item \textit{Gabarit}
      \item Équivalent des "instance types" d'AWS
      \item Définit un modèle d'instance en termes de CPU, RAM, disque (racine), disque éphémère
      \item Un disque de taille nul équivaut à prendre la taille de l'image de base
      \item Le disque éphémère a, comme le disque racine, l'avantage d'être souvent local donc rapide
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Propriétés des images dans Glance}
    L'utilisateur peut définir un certain nombre de propriétés dont certaines seront utilisées lors de l'instanciation
    \begin{itemize}
      \item Type d'image
      \item Architecture
      \item Distribution
      \item Version de la distribution
      \item Espace disque minimum
      \item RAM minimum
      \item Publique ou non
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Types d'images}
    Glance supporte un large éventail de types d'images, limité par le support de l'hyperviseur sous-jacent à Nova
    \begin{itemize}
      \item raw
      \item qcow2
      \item ami
      \item vmdk
      \item iso
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Fonctionnalités supplémentaires}
    Outre les fonctions réseau de base niveaux 2 et 3, Neutron peut fournir d'autres services :
    \begin{itemize}
      \item Load Balancing (HAProxy, ...)
      \item Firewall (vArmour, ...) : diffère des groupes de sécurité
      \item VPN (Openswan, ...) : permet d'accéder à un réseau privé sans IP flottantes
    \end{itemize}
    Ces fonctionnalités se basent également sur des plugins
  \end{frame}

  \begin{frame}
    \frametitle{API}
    L'API permet notamment de manipuler ces ressources
    \begin{itemize}
      \item Réseau (\textit{network}) : niveau 2
      \item Sous-réseau (\textit{subnet}) : niveau 3
      \item Port : attachable à une interface sur une instance, un load-balancer, etc.
      \item Routeur
    \end{itemize}
  \end{frame}

  \begin{frame}[containsverbatim]
    \frametitle{Un template HOT}
    \textit{parameters} - \textit{resources} - \textit{outputs}
\begin{verbatim}
heat_template_version: 2013-05-23

description: Simple template to deploy a single compute instance

resources:
  my_instance:
    type: OS::Nova::Server
    properties:
      key_name: my_key
      image: F18-x86_64-cfntools
      flavor: m1.small
\end{verbatim}
  \end{frame}

  \begin{frame}
    \frametitle{Construire un template à partir d'existant}
    Multiples projets en cours de développement
    \begin{itemize}
      \item Flame (Cloudwatt)
      \item HOT builder
      \item Merlin
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Un grand cloud}
    \begin{itemize}
      \item Régions
      \item Zones de disponibilité (AZ)
    \end{itemize}
  \end{frame}
